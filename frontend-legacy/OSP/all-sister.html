<!doctype html>
<html class="no-js" lang="">


<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>OSP | All Nữ tu</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Favicon -->
    <link rel="shortcut icon" type="image/x-icon" href="img/favicon.png">
    <!-- Normalize CSS -->
    <link rel="stylesheet" href="css/normalize.css">
    <!-- Main CSS -->
    <link rel="stylesheet" href="css/main.css">
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <!-- Fontawesome CSS -->
    <link rel="stylesheet" href="css/all.min.css">
    <!-- Flaticon CSS -->
    <link rel="stylesheet" href="fonts/flaticon.css">
    <!-- Animate CSS -->
    <link rel="stylesheet" href="css/animate.min.css">
    <!-- Data Table CSS -->
    <link rel="stylesheet" href="css/jquery.dataTables.min.css">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="style.css">
    <!-- Modernize js -->
    <script src="js/modernizr-3.6.0.min.js"></script>
</head>

<body>
    <!-- Preloader Start Here -->
    <div id="preloader"></div>
    <!-- Preloader End Here -->
    <div id="wrapper" class="wrapper bg-ash">
        <!-- Header Menu Area Start Here -->
        <div id="header-placeholder"></div>
        <!-- Header Menu Area End Here -->
        <!-- Page Area Start Here -->
        <div class="dashboard-page-one">
            <!-- Sidebar Area Start Here -->
            <div id="sidebar-placeholder"></div>
            <!-- Sidebar Area End Here -->
            <div class="dashboard-content-one">
                <!-- Breadcubs Area Start Here -->
                <div class="breadcrumbs-area">
                    <h3>Nữ tu</h3>
                    <ul>
                        <li>
                            <a href="index.html">Home</a>
                        </li>
                        <li>All Nữ tu</li>
                    </ul>
                </div>
                <!-- Breadcubs Area End Here -->
                <!-- Nữ tu Table Area Start Here -->
                <div class="card height-auto">
                    <div class="card-body">

                        <div class="table-responsive">
                            <table class="table display data-table text-nowrap">
                                <thead>
                                    <tr>
                                        <th>
                                            <div class="form-check">
                                                <input type="checkbox" class="form-check-input checkAll">
                                                <label class="form-check-label">Mã số</label>
                                            </div>
                                        </th>
                                        <th>Tên khai sinh</th>
                                        <th>Tên dòng</th>
                                        <th>Ngày sinh</th>
                                        <th></th>
                                    </tr>
                                </thead>
                                <tbody id="sister-data">
                                    <!-- Data will be loaded here via JS -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                <!-- Nữ tu Table Area End Here -->

            </div>
        </div>
        <!-- Page Area End Here -->
    </div>
    <!-- jquery-->
    <script src="js/jquery-3.3.1.min.js"></script>
    <!-- Plugins js -->
    <script src="js/plugins.js"></script>
    <!-- Popper js -->
    <script src="js/popper.min.js"></script>
    <!-- Bootstrap js -->
    <script src="js/bootstrap.min.js"></script>
    <!-- Scroll Up Js -->
    <script src="js/jquery.scrollUp.min.js"></script>
    <!-- Data Table Js -->
    <script src="js/jquery.dataTables.min.js"></script>
    <!-- Custom Js -->
    <script src="js/main.js"></script>
    <!-- Load Components Js -->
    <script src="js/load-components.js"></script>
    <script>
        $(document).ready(function () {
            const token = localStorage.getItem('token');
            if (!token) {
                window.location.href = 'login.html';
                return;
            }

            function formatDate(dateString) {
                if (!dateString) return '';
                const date = new Date(dateString);
                return date.toLocaleDateString('vi-VN');
            }

            function loadSisters() {
                $.ajax({
                    url: 'http://localhost:5000/api/sisters?limit=1000',
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    },
                    success: function (response) {
                        const sisters = response.data;
                        const tbody = $('#sister-data');

                        // Destroy existing DataTable if it exists so we can update the DOM
                        if ($.fn.DataTable.isDataTable('.data-table')) {
                            $('.data-table').DataTable().destroy();
                        }

                        tbody.empty();

                        if (sisters.length === 0) {
                            tbody.append('<tr><td colspan="5" class="text-center">Không có dữ liệu</td></tr>');
                            return;
                        }

                        sisters.forEach(sister => {
                            const photoUrl = sister.photo_url ? sister.photo_url : 'img/figure/default-sister.png';
                            const row = `
                                <tr>
                                    <td>
                                        <div class="form-check">
                                            <input type="checkbox" class="form-check-input">
                                            <label class="form-check-label">${sister.code}</label>
                                        </div>
                                    </td>
                                    <td>${sister.birth_name || ''}</td>
                                    <td>${sister.religious_name || ''}</td>
                                    <td>${formatDate(sister.date_of_birth)}</td>
                                    <td>
                                        <div class="dropdown">
                                            <a href="#" class="dropdown-toggle" data-toggle="dropdown" aria-expanded="false">
                                                <span class="flaticon-more-button-of-three-dots"></span>
                                            </a>
                                            <div class="dropdown-menu dropdown-menu-right">
                                                <a class="dropdown-item" href="sister-details.html?id=${sister.id}"><i class="fas fa-eye text-dark-pastel-green"></i>Xem</a>
                                                <a class="dropdown-item" href="edit-sister.html?id=${sister.id}"><i class="fas fa-cogs text-dark-pastel-green"></i>Sửa</a>
                                                <a class="dropdown-item delete-sister" href="#" data-id="${sister.id}"><i class="fas fa-times text-orange-red"></i>Xóa</a>
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                            `;
                            tbody.append(row);
                        });

                        // Re-initialize DataTables
                        $('.data-table').DataTable({
                            paging: true,
                            searching: true,
                            info: true,
                            lengthChange: true,
                            lengthMenu: [20, 50, 100],
                            columnDefs: [
                                {
                                    targets: [0, -1], // column or columns numbers
                                    orderable: false, // set orderable for selected columns
                                },
                            ],
                            language: {
                                search: "Tìm kiếm:",
                                lengthMenu: "Hiển thị _MENU_ bản ghi",
                                info: "Hiển thị _START_ đến _END_ của _TOTAL_ bản ghi",
                                infoEmpty: "Hiển thị 0 đến 0 của 0 bản ghi",
                                infoFiltered: "(được lọc từ _MAX_ bản ghi)",
                                paginate: {
                                    first: "Đầu",
                                    last: "Cuối",
                                    next: "Sau",
                                    previous: "Trước"
                                },
                                emptyTable: "Không có dữ liệu trong bảng",
                                zeroRecords: "Không tìm thấy kết quả phù hợp"
                            }
                        });
                    },
                    error: function (xhr) {
                        console.error('Error loading sisters:', xhr);
                        if (xhr.status === 401) {
                            window.location.href = 'login.html';
                        } else {
                            alert('Không thể tải danh sách nữ tu.');
                        }
                    }
                });
            }

            loadSisters();

            // Handle Delete
            $(document).on('click', '.delete-sister', function (e) {
                e.preventDefault();
                const id = $(this).data('id');
                if (confirm('Bạn có chắc chắn muốn xóa nữ tu này?')) {
                    $.ajax({
                        url: `http://localhost:5000/api/sisters/${id}`,
                        method: 'DELETE',
                        headers: {
                            'Authorization': `Bearer ${token}`
                        },
                        success: function () {
                            alert('Xóa thành công');
                            loadSisters();
                        },
                        error: function (xhr) {
                            alert('Xóa thất bại: ' + (xhr.responseJSON ? xhr.responseJSON.message : xhr.statusText));
                        }
                    });
                }
            });
        });
    </script>
</body>


<!-- Mirrored from www.radiustheme.com/demo/html/psdboss/OSP/OSP/all-sister.html by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 15 Aug 2025 06:47:58 GMT -->

</html>