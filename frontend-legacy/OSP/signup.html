<!doctype html>
<html class="no-js" lang="">

<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>OSP | Signup</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Favicon -->
    <link rel="shortcut icon" type="image/x-icon" href="img/favicon.png">
    <!-- Normalize CSS -->
    <link rel="stylesheet" href="css/normalize.css">
    <!-- Main CSS -->
    <link rel="stylesheet" href="css/main.css">
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <!-- Fontawesome CSS -->
    <link rel="stylesheet" href="css/all.min.css">
    <!-- Flaticon CSS -->
    <link rel="stylesheet" href="fonts/flaticon.css">
    <!-- Animate CSS -->
    <link rel="stylesheet" href="css/animate.min.css">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="style.css">
    <!-- Modernize js -->
    <script src="js/modernizr-3.6.0.min.js"></script>
</head>

<body>
    <!-- Preloader Start Here -->
    <div id="preloader"></div>
    <!-- Preloader End Here -->
    <!-- Login Page Start Here -->
    <div class="login-page-wrap">
        <div class="login-page-content">
            <div class="login-box">
                <div class="item-logo">
                    <img src="img/logo2.png" alt="logo">
                </div>
                <form id="signup-form" class="login-form">
                    <div class="form-group">
                        <label>Username</label>
                        <input type="text" id="username" placeholder="Enter username" class="form-control" required>
                        <i class="far fa-user"></i>
                    </div>
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" id="email" placeholder="Enter email" class="form-control" required>
                        <i class="far fa-envelope"></i>
                    </div>
                    <div class="form-group">
                        <label>Password</label>
                        <input type="password" id="password" placeholder="Enter password" class="form-control" required>
                        <i class="fas fa-lock"></i>
                    </div>
                    <div class="form-group">
                        <label>Confirm Password</label>
                        <input type="password" id="confirm-password" placeholder="Confirm password" class="form-control"
                            required>
                        <i class="fas fa-lock"></i>
                    </div>
                    <div class="form-group">
                        <button type="submit" class="login-btn">Sign Up</button>
                    </div>
                    <div id="signup-error" class="text-danger mt-3" style="display:none;"></div>
                    <div id="signup-success" class="text-success mt-3" style="display:none;"></div>
                </form>
            </div>
            <div class="sign-up">Already have an account ? <a href="login.html">Login now!</a></div>
        </div>
    </div>
    <!-- Login Page End Here -->
    <!-- jquery-->
    <script src="js/jquery-3.3.1.min.js"></script>
    <!-- Plugins js -->
    <script src="js/plugins.js"></script>
    <!-- Popper js -->
    <script src="js/popper.min.js"></script>
    <!-- Bootstrap js -->
    <script src="js/bootstrap.min.js"></script>
    <!-- Scroll Up Js -->
    <script src="js/jquery.scrollUp.min.js"></script>
    <!-- Custom Js -->
    <script src="js/main.js"></script>

    <script>
        $(document).ready(function () {
            $('#signup-form').on('submit', function (e) {
                e.preventDefault();

                const username = $('#username').val();
                const email = $('#email').val();
                const password = $('#password').val();
                const confirmPassword = $('#confirm-password').val();
                const $error = $('#signup-error');
                const $success = $('#signup-success');
                const $btn = $('.login-btn');

                $error.hide();
                $success.hide();

                if (password !== confirmPassword) {
                    $error.text("Passwords do not match").show();
                    return;
                }

                $btn.prop('disabled', true).text('Signing up...');

                $.ajax({
                    url: 'http://localhost:5000/api/auth/register',
                    method: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify({ username, email, password, role: 'viewer' }), // Default role
                    success: function (response) {
                        $success.text("Account created successfully! Redirecting to login...").show();
                        setTimeout(function () {
                            window.location.href = 'login.html';
                        }, 2000);
                    },
                    error: function (xhr) {
                        let msg = 'Signup failed';
                        if (xhr.responseJSON) {
                            if (xhr.responseJSON.message) {
                                msg = xhr.responseJSON.message;
                            } else if (xhr.responseJSON.errors && Array.isArray(xhr.responseJSON.errors)) {
                                msg = xhr.responseJSON.errors.map(e => e.message).join('<br>');
                            }
                        }
                        $error.html(msg).show();
                        $btn.prop('disabled', false).text('Sign Up');
                    }
                });
            });
        });
    </script>

</body>

</html>


