<!doctype html>
<html class="no-js" lang="">


<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>OSP | Thông tin thành viên</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Favicon -->
    <link rel="shortcut icon" type="image/x-icon" href="img/favicon.png">
    <!-- Normalize CSS -->
    <link rel="stylesheet" href="css/normalize.css">
    <!-- Main CSS -->
    <link rel="stylesheet" href="css/main.css">
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <!-- Fontawesome CSS -->
    <link rel="stylesheet" href="css/all.min.css">
    <!-- Flaticon CSS -->
    <link rel="stylesheet" href="fonts/flaticon.css">
    <!-- Animate CSS -->
    <link rel="stylesheet" href="css/animate.min.css">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="style.css">
    <!-- Modernize js -->
    <script src="js/modernizr-3.6.0.min.js"></script>
</head>

<body>
    <!-- Preloader Start Here -->
    <div id="preloader"></div>
    <!-- Preloader End Here -->
    <div id="wrapper" class="wrapper bg-ash">
        <!-- Header Menu Area Start Here -->
        <div id="header-placeholder"></div>
        <!-- Header Menu Area End Here -->
        <!-- Page Area Start Here -->
        <div class="dashboard-page-one">
            <!-- Sidebar Area Start Here -->
            <div id="sidebar-placeholder"></div>
            <!-- Sidebar Area End Here -->
            <div class="dashboard-content-one">
                <!-- Breadcubs Area Start Here -->
                <div class="breadcrumbs-area">
                    <h3>Nữ tu</h3>
                    <ul>
                        <li>
                            <a href="index.html">Home</a>
                        </li>
                        <li>Thông tin thành viên</li>
                    </ul>
                </div>
                <!-- Breadcubs Area End Here -->
                <!-- Nữ tu Details Area Start Here -->
                <div class="card height-auto">
                    <div class="card-body">
                        <div class="heading-layout1">
                            <div class="item-title">
                                <h3>THÔNG TIN CHI TIẾT</h3>
                            </div>
                            <div class="dropdown">
                                <a class="dropdown-toggle" href="#" role="button" data-toggle="dropdown"
                                    aria-expanded="false">...</a>

                                <div class="dropdown-menu dropdown-menu-right">
                                    <a class="dropdown-item" href="#" id="btn-edit-sister"><i
                                            class="fas fa-cogs text-dark-pastel-green"></i>Sửa</a>
                                    <a class="dropdown-item" href="#" id="btn-delete-sister"><i
                                            class="fas fa-times text-orange-red"></i>Xóa</a>
                                    <a class="dropdown-item" href="all-sister.html"><i
                                            class="fas fa-list text-orange-peel"></i>Danh sách</a>
                                </div>
                            </div>
                        </div>
                        <div class="single-info-details">
                            <div class="item-img">
                                <img id="detail-photo" src="" alt="Thành viên"
                                    style="max-width: 200px; max-height: 200px; border-radius: 5px; border: 1px solid #ddd; background-color: #f5f5f5;">
                            </div>
                            <div class="item-content">
                                <div class="header-inline item-header">
                                    <h3 class="text-dark-medium font-medium" id="detail-birth-name"></h3>
                                    <div class="header-elements">
                                        <ul>
                                            <li><a href="#" id="header-edit-sister" title="Sửa"><i
                                                        class="far fa-edit"></i></a></li>
                                            <li><a href="#" onclick="window.print()" title="In"><i
                                                        class="fas fa-print"></i></a></li>
                                            <li><a href="all-sister.html" title="Danh sách"><i
                                                        class="fas fa-list"></i></a></li>
                                        </ul>
                                    </div>
                                </div>
                                <p id="detail-bio"></p>
                                <div class="info-table table-responsive">
                                    <table class="table text-nowrap">
                                        <tbody>
                                            <tr>
                                                <td>Mã số:</td>
                                                <td class="font-medium text-dark-medium" id="table-code"></td>
                                            </tr>
                                            <tr>
                                                <td>Tên dòng:</td>
                                                <td class="font-medium text-dark-medium" id="table-religious-name"></td>
                                            </tr>
                                            <tr>
                                                <td>Tên thánh:</td>
                                                <td class="font-medium text-dark-medium" id="table-saint-name"></td>
                                            </tr>
                                            <tr>
                                                <td>Tên khai sinh:</td>
                                                <td class="font-medium text-dark-medium" id="table-birth-name"></td>
                                            </tr>
                                            <tr>
                                                <td>Tên thường gọi:</td>
                                                <td class="font-medium text-dark-medium" id="table-prefer-name"></td>
                                            </tr>
                                            <tr>
                                                <td>Ngày sinh:</td>
                                                <td class="font-medium text-dark-medium" id="table-dob"></td>
                                            </tr>
                                            <tr>
                                                <td>Nơi sinh:</td>
                                                <td class="font-medium text-dark-medium" id="table-pob"></td>
                                            </tr>
                                            <tr>
                                                <td>Nguyên quán:</td>
                                                <td class="font-medium text-dark-medium" id="table-hometown"></td>
                                            </tr>
                                            <tr>
                                                <td>Địa chỉ thường trú:</td>
                                                <td class="font-medium text-dark-medium" id="table-permanent-address">
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>Quốc tịch:</td>
                                                <td class="font-medium text-dark-medium" id="table-nationality"></td>
                                            </tr>
                                            <tr>
                                                <td>CCCD/Passport:</td>
                                                <td class="font-medium text-dark-medium" id="table-id-number"></td>
                                            </tr>
                                            <tr>
                                                <td>Trạng thái:</td>
                                                <td class="font-medium text-dark-medium" id="table-status"></td>
                                            </tr>
                                            <tr>
                                                <td>Tên cha:</td>
                                                <td class="font-medium text-dark-medium" id="table-father"></td>
                                            </tr>
                                            <tr>
                                                <td>Tên mẹ:</td>
                                                <td class="font-medium text-dark-medium" id="table-mother"></td>
                                            </tr>
                                            <tr>
                                                <td>Tôn giáo gia đình:</td>
                                                <td class="font-medium text-dark-medium" id="table-religion"></td>
                                            </tr>
                                            <tr>
                                                <td>Email:</td>
                                                <td class="font-medium text-dark-medium" id="table-email"></td>
                                            </tr>
                                            <tr>
                                                <td>Số điện thoại:</td>
                                                <td class="font-medium text-dark-medium" id="table-phone"></td>
                                            </tr>
                                            <tr>
                                                <td>Ngày rửa tội:</td>
                                                <td class="font-medium text-dark-medium" id="table-baptism"></td>
                                            </tr>
                                            <tr>
                                                <td>Nơi rửa tội:</td>
                                                <td class="font-medium text-dark-medium" id="table-baptism-place"></td>
                                            </tr>
                                            <tr>
                                                <td>Ngày thêm sức:</td>
                                                <td class="font-medium text-dark-medium" id="table-confirmation"></td>
                                            </tr>
                                            <tr>
                                                <td>Ngày rước lễ lần đầu:</td>
                                                <td class="font-medium text-dark-medium" id="table-first-communion">
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>Liên hệ khẩn cấp:</td>
                                                <td class="font-medium text-dark-medium" id="table-emergency-contact">
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>Ghi chú:</td>
                                                <td class="font-medium text-dark-medium" id="table-notes"></td>
                                            </tr>
                                            <tr>
                                                <td>Giấy tờ đính kèm:</td>
                                                <td class="font-medium text-dark-medium" id="table-documents"></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Nữ tu Details Area End Here -->

            </div>
        </div>
        <!-- Page Area End Here -->
    </div>
    <!-- jquery-->
    <script src="js/jquery-3.3.1.min.js"></script>
    <!-- Plugins js -->
    <script src="js/plugins.js"></script>
    <!-- Popper js -->
    <script src="js/popper.min.js"></script>
    <!-- Bootstrap js -->
    <script src="js/bootstrap.min.js"></script>
    <!-- Scroll Up Js -->
    <script src="js/jquery.scrollUp.min.js"></script>
    <!-- Custom Js -->
    <script src="js/main.js"></script>

    <script>
        $(document).ready(function () {
            // Helper to format date from yyyy-mm-dd to dd/mm/yyyy
            function formatDate(dateStr) {
                if (!dateStr) return '';
                const date = new Date(dateStr);
                if (isNaN(date.getTime())) return dateStr;
                const day = String(date.getDate()).padStart(2, '0');
                const month = String(date.getMonth() + 1).padStart(2, '0');
                const year = date.getFullYear();
                return `${day}/${month}/${year}`;
            }

            // Get ID from URL
            const urlParams = new URLSearchParams(window.location.search);
            const sisterId = urlParams.get('id');
            console.log("Sister ID from URL:", sisterId);

            if (!sisterId) {
                // Try to get from localStorage as a fallback (optional, but helpful for debugging)
                const lastId = localStorage.getItem('last_created_sister_id');
                if (lastId) {
                    console.log("Found ID in localStorage:", lastId);
                    if (confirm('Không tìm thấy ID trên URL, nhưng tìm thấy ID vừa tạo: ' + lastId + '. Bạn có muốn xem không?')) {
                        window.location.href = 'sister-details.html?id=' + lastId;
                        return;
                    }
                }

                alert('Không tìm thấy ID Nữ tu trên thanh địa chỉ (URL). Vui lòng quay lại danh sách và chọn một Nữ tu.');
                return;
            }

            const token = localStorage.getItem('token');
            if (!token) {
                window.location.href = 'login.html';
                return;
            }

            $.ajax({
                url: `http://localhost:5000/api/sisters/${sisterId}`,
                method: 'GET',
                headers: {
                    'Authorization': `Bearer ${token}`
                },
                success: function (data) {
                    // Populate fields
                    $('#detail-birth-name').text(data.birth_name || 'N/A');
                    $('#table-code').text(data.code || '');
                    $('#table-religious-name').text(data.religious_name || '');
                    $('#table-saint-name').text(data.saint_name || '');
                    $('#table-birth-name').text(data.birth_name || '');
                    $('#table-prefer-name').text(data.prefer_name || '');
                    $('#table-dob').text(formatDate(data.date_of_birth));
                    $('#table-pob').text(data.place_of_birth || '');
                    $('#table-hometown').text(data.hometown || '');
                    $('#table-permanent-address').text(data.permanent_address || '');
                    $('#table-nationality').text(data.nationality || '');
                    $('#table-id-number').text(data.id_number || '');

                    // Status display
                    let statusText = '';
                    if (data.status === 'active') statusText = 'Đang tu dòng';
                    else if (data.status === 'left') statusText = 'Tu xuất';
                    else statusText = data.status || '';
                    $('#table-status').text(statusText);

                    $('#table-father').text(data.father_name || '');
                    $('#table-mother').text(data.mother_name || '');
                    $('#table-religion').text(data.family_religion || '');
                    $('#table-email').text(data.email || '');
                    $('#table-phone').text(data.phone || '');
                    $('#table-baptism').text(formatDate(data.baptism_date));
                    $('#table-baptism-place').text(data.baptism_place || '');
                    $('#table-confirmation').text(formatDate(data.confirmation_date));
                    $('#table-first-communion').text(formatDate(data.first_communion_date));
                    $('#table-notes').text(data.notes || '');

                    let emergency = '';
                    if (data.emergency_contact_name) emergency += data.emergency_contact_name;
                    if (data.emergency_contact_phone) emergency += ` (${data.emergency_contact_phone})`;
                    $('#table-emergency-contact').text(emergency);

                    // Load ảnh từ database (photo_url)
                    if (data.photo_url) {
                        $('#detail-photo').attr('src', `http://localhost:5000${data.photo_url}`);
                    } else {
                        // Ảnh mặc định nếu không có trong database
                        $('#detail-photo').attr('src', 'img/figure/sister.png');
                    }

                    // Documents
                    let documents = [];
                    if (data.documents_url) {
                        try {
                            documents = JSON.parse(data.documents_url);
                        } catch (e) {
                            documents = [];
                        }
                    }

                    if (documents.length > 0) {
                        let docsHtml = '<ul class="list-unstyled mb-0">';
                        documents.forEach(doc => {
                            const icon = doc.name.endsWith('.pdf') ? 'fa-file-pdf text-danger' :
                                doc.name.endsWith('.doc') || doc.name.endsWith('.docx') ? 'fa-file-word text-primary' :
                                    doc.name.match(/\.(jpg|jpeg|png)$/i) ? 'fa-file-image text-success' : 'fa-file text-secondary';
                            docsHtml += `<li><i class="fas ${icon} mr-1"></i><a href="http://localhost:5000${doc.url}" target="_blank">${doc.name}</a></li>`;
                        });
                        docsHtml += '</ul>';
                        $('#table-documents').html(docsHtml);
                    } else {
                        $('#table-documents').text('Không có');
                    }
                },
                error: function (xhr) {
                    console.error(xhr);
                    alert('Không thể tải thông tin Nữ tu.');
                }
            });

            // Handle Edit button click
            $('#btn-edit-sister, #header-edit-sister').on('click', function (e) {
                e.preventDefault();
                window.location.href = `edit-sister.html?id=${sisterId}`;
            });

            // Handle Delete button click
            $('#btn-delete-sister').on('click', function (e) {
                e.preventDefault();
                if (confirm('Bạn có chắc chắn muốn xóa nữ tu này?')) {
                    $.ajax({
                        url: `http://localhost:5000/api/sisters/${sisterId}`,
                        method: 'DELETE',
                        headers: {
                            'Authorization': `Bearer ${token}`
                        },
                        success: function () {
                            alert('Xóa thành công!');
                            window.location.href = 'all-sister.html';
                        },
                        error: function (xhr) {
                            alert('Xóa thất bại: ' + (xhr.responseJSON ? xhr.responseJSON.message : xhr.statusText));
                        }
                    });
                }
            });
        });
    </script>
    <!-- Load Components Js -->
    <script src="js/load-components.js"></script>
</body>


<!-- Mirrored from www.radiustheme.com/demo/html/psdboss/OSP/OSP/sister-details.html by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 15 Aug 2025 06:47:58 GMT -->

</html>